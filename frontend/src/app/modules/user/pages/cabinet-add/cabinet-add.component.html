<div class="main-container">
  <app-container-layout>
    <app-section-layout sectionTitle="Wybór leku">
      @if (selectedDrug) {
        <div class="selected-drug-container">
          <p class="text-1"><b>Wybrano: </b>{{ selectedDrug.name }}</p>
          <button mat-button (click)="selectDrug(null)"><p class="text-1">edytuj</p></button>
        </div>
      } @else {
        <app-table
          [data]="tableData"
          [columns]="userDrugsDisplayedColumns"
          [pagination]="pagination"
          [isSearching]="isDrugsSearching$ | async"
          [searchable]="true"
          emptyInfo="Brak leków"
          type="selectable"
          (onSelectEmit)="selectDrug($event)"
          (onSearchEmit)="onSearch($event)"
          (pageChange)="handlePageEvent($event)"
        />
      }
    </app-section-layout>

    @if (selectedDrug) {
      <app-section-layout sectionTitle="Priorytet">
        <mat-form-field appearance="outline">
          <mat-label>Priorytet</mat-label>
          <mat-select [(ngModel)]="data().priority">
            <mat-option value="LOW">Niski</mat-option>
            <mat-option value="HIGH">Wysoki</mat-option>
          </mat-select>
        </mat-form-field>
      </app-section-layout>

      <app-section-layout sectionTitle="Dawkowanie">
        <div class="section-container">
          <div class="grid">
            @for (day of days; track day) {
              <app-day-tail [isChecked]="data().days.includes(day)" (toggleClick)="toggleDay($event, day)" [day]="day"></app-day-tail>
            }
          </div>

          <div class="dose-time-container">
            <p class="subtitle-1" style="min-width: 150px;">Wielkość dawki: </p>
            <mat-form-field appearance="outline">
              <mat-label>{{ selectedDrug.unit }}</mat-label>
              <input matInput type="text" [(ngModel)]="data().doseSize" [placeholder]="selectedDrug.unit">
            </mat-form-field>
          </div>

          <div *ngFor="let time of data().times; let i = index" class="dose-time-container" [@animateExpand]>
            <p class="subtitle-1" style="min-width: 150px;">Godzina {{ i + 1 }} przyjęcia:</p>
            <mat-form-field appearance="outline">
              <mat-label>Godzina</mat-label>
              <mat-select [(ngModel)]="time.hours" (ngModelChange)="updateTime(i)">
                <mat-option *ngFor="let hour of hours" [value]="hour">{{ hour }}</mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Minuta</mat-label>
              <mat-select [(ngModel)]="time.minutes" (ngModelChange)="updateTime(i)">
                <mat-option *ngFor="let minute of minutes" [value]="minute">{{ minute }}</mat-option>
              </mat-select>
            </mat-form-field>
            @if (i === 0) {
              <button mat-button (click)="addTime()"><p>Dodaj kolejną godzinę</p></button>
            } @else {
              <button *ngIf="i > 0" mat-button (click)="removeTime(i)" class="remove-text-btn"><p>Usuń</p></button>
            }
          </div>
        </div>
      </app-section-layout>
    }
  </app-container-layout>
</div>
